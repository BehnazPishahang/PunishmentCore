@using Anu.PunishmentOrg.Client.Infrastructure.Settings
@using Anu.PunishmentOrg.Client.Pages.Authentication
@inherits LayoutComponentBase
@inject IDialogService DialogService

<MudRTLProvider RightToLeft="true">
        <MudThemeProvider Theme="_theme" @bind-IsDarkMode="@_isDarkMode" />
    
          <MudDrawer @bind-Open="_drawerOpen" ClipMode="_themeManager.DrawerClipMode" Elevation="_themeManager.DrawerElevation" Style="padding: 1vw"></MudDrawer>

        <MudDialogProvider
                FullWidth="true"
                MaxWidth="MaxWidth.ExtraSmall"
                CloseButton="true"
                DisableBackdropClick="true"
                NoHeader="true"
                Position="DialogPosition.Center"
                CloseOnEscapeKey="true"
            />
        <MudSnackbarProvider />

        <MudLayout  >
            
           
           @* <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Inherit"OnClick="@((e) => OpenThemeManager(true))" />*@
            <MudAppBar Elevation="1">
                 
              <MudIconButton Icon="@_menuIcons" Color="@Theme135._iconColor" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
                 @*  <MudImage Src="/pic/Anulogo.png"  Elevation="25" Class="rounded-lg"/>*@
                     
              <MudThemeManagerButton OnClick="@((e) => OpenThemeManager(true))" />
                    <MudIcon Icon="@Icons.Filled.Balance" Size="Size.Large" Color="Color.Tertiary" />
                    <MudText Typo="Typo.h5" Class="mr-3" Color="Color.Default"> میز خدمت تعزیرات حکومتی   </MudText>
                <MudSpacer />
       
              <MudIconButton Icon="@_dayNightIcons" Color="@Theme135._iconColor" @onclick="onDarkMode" />
              <MudThemeManager Open="_themeManagerOpen" OpenChanged="OpenThemeManager" Theme="_themeManager" ThemeChanged="UpdateTheme"  />
           
              <MudMenu Direction="Direction.Right" OffsetX="true" Dense="true" Class="mt-1 ml-4" ActivationEvent="@MouseEvent.MouseOver" AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter">

                <ActivatorContent>
                     @if(String.IsNullOrEmpty(SharedInfo.NationalCode))
                    {
                        <MudChip Icon="@Icons.Material.Filled.Person" Color="Color.Primary">ورود</MudChip>

                    }
                    else
                    {
                         <MudChip Icon="@Icons.Material.Filled.Person" Color="Color.Primary">@SharedInfo.NationalCode</MudChip>

                    }
                </ActivatorContent>

                <ChildContent   >
                    <UserCard Class="mt-n2" />
                    <MudDivider Class="mb-2" />
                    @if(String.IsNullOrEmpty(SharedInfo.NationalCode))
                    {
                            <MudListItem Text="ورود " Icon="@Icons.Filled.Logout"  Href="/login2" />
                        <MudListItem Text="ثبت نام " Href="/register" Icon="@Icons.Material.Filled.AppRegistration" />
                    }
                    else
                    {
                        <MudListItem Text="پروفایل کاربر " Icon="@Icons.Filled.Person"   />
                        <MudListItem Text=" تغییر شماره تلفن "  Icon="@Icons.Filled.PhonelinkSetup"   />
                         <MudListItem Text="خروج"  Icon="@Icons.Filled.Logout"  OnClick="Logout" />
                    }

                </ChildContent>
            </MudMenu>
            </MudAppBar>
            <MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
                   @* <NavMenu />*@
                    <MudNavMenu Color="@Theme135._iconColor">
                           @if(String.IsNullOrEmpty(SharedInfo.NationalCode))
                            {
                                <MudNavMenu Color="Color.Primary">
                                <MudNavLink Href="/dashboard" Match="NavLinkMatch.All" Icon="@Icons.Filled.Home"  IconColor="@Theme135._iconColor"> خدمات الکترونیکی تعزیرات </MudNavLink>
 
    
                                        <MudNavLink Href="/Granovment" Icon="@Icons.Filled.DocumentScanner" IconColor="@Theme135._iconColor">
                                             ثبت شکایت 
                                        </MudNavLink>
                                          <MudNavLink Href="/isConstracting" Icon="@Icons.Material.Filled.Payments" IconColor="@Theme135._iconColor">
                                             پرداخت وجه 
                                        </MudNavLink>
                            </MudNavMenu>
                            }
                            else
                               {
                                    <MudNavLink Href="/dashboard" Match="NavLinkMatch.All" Icon="@Icons.Filled.Home"  IconColor = "@Theme135._iconColor"  > خدمات الکترونیکی تعزیرات </MudNavLink>
     
                                              <MudNavLink id="FrmNoticeMain" Href="/FrmNotice" Icon="@Icons.Filled.ManageSearch"   IconColor = "@Theme135._iconColor" >
                                                        جستجوی ابلاغ
                                                    </MudNavLink>
                                                    <MudNavLink Href="/Granovment" Icon="@Icons.Filled.DocumentScanner"  IconColor = "@Theme135._iconColor" >
                                                         ثبت شکایت 
                                                    </MudNavLink>
                                                      <MudNavLink Href="/isConstracting" Icon="@Icons.Material.Filled.Payments"  IconColor="@Theme135._iconColor"  >
                                                         پرداخت وجه 
                                                    </MudNavLink>
                                                    <MudNavLink Href="/isConstracting" Icon="@Icons.Material.Filled.DocumentScanner"  IconColor = "@Theme135._iconColor"  >
                                                        لایحه
                                                    </MudNavLink>
                                                        <MudNavLink Href="/isConstracting" Icon="@Icons.Filled.DriveFileRenameOutline"  IconColor = "@Theme135._iconColor">
                                                        درخواست تجدید نظر خواهی 
                                                    </MudNavLink>
                                                     <MudNavLink Href="/isConstracting" Icon="@Icons.Filled.DonutLarge" IconColor = "@Theme135._iconColor" >
                                                       درخواست اعمال ماده ۲۳ 
                                                    </MudNavLink>
                                                      <MudNavLink Href="/isConstracting" Icon="@Icons.Filled.EscalatorWarning" IconColor = "@Theme135._iconColor" >
                                                        ثبت وکالت نامه 
                                                    </MudNavLink>
                                                        <MudNavLink Href="/isConstracting" Icon="@Icons.Filled.DoorSliding"  IconColor = "@Theme135._iconColor">
                                                        درخواست رسیدگی مجدد  
                                                    </MudNavLink>
                                                     <MudNavLink Href="/isConstracting" Icon="@Icons.Custom.Uncategorized.FolderOpen" IconColor = "@Theme135._iconColor" >
                                                     پیگیری پرونده 
                                                    </MudNavLink>
                                                     <MudNavLink Href="/isConstracting" Icon="@Icons.Filled.EmojiPeople" IconColor = "@Theme135._iconColor" >
                                                     ثبت اعتراض  
                                                    </MudNavLink>
                                 }
        
                </MudNavMenu>
            </MudDrawer>
            <MudMainContent >  
                @Body
            </MudMainContent>
        </MudLayout>

</MudRTLProvider>

@code {
    [Parameter]
    public  bool _isDarkMode { set; get; } = false;
    private static string _dayNightIcons = Icons.Material.Filled.DarkMode;
    private static string _menuIcons = Icons.Material.Filled.MenuOpen;

    public static string _style ="height:100px;background-color:#ede3e3";
    public static string _class ="Circle_night";
    public static bool DarkMode = true;
    private MudTheme _theme = Theme135.DefaultTheme;

    private bool _Day = false;
    private bool _Night = true;

    public EventCallback OnDarkModeToggle { get; set; }
    bool _drawerOpen = true;

    void showlogin()
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };
        DialogService.Show<Login>("Simple Dialog", options);
    }
    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
        if(_drawerOpen)
            _menuIcons = Icons.Material.Filled.MenuOpen;
        else
            _menuIcons = Icons.Material.Filled.Menu;

    }

    public void Logout()
    {
        SharedInfo.NationalCode = string.Empty;
        _navigationManager.NavigateTo("/DashboardPublic");    
    }


    public void onDarkMode()
    {
    
        if(! _isDarkMode )
        {
            Theme135._iconColor = Color.Success ;
            Theme135._LogoColor = Color.Success;

            _style ="height:100px;background-color:#181c1c";
            _class ="Circle";
            _dayNightIcons = Icons.Material.Filled.LightMode;

        }
        else
        {
            Theme135._iconColor = Color.Info;
            Theme135._LogoColor = Color.Surface;
            _style ="height:100px;background-color:#ede3e3";
            _class ="Circle_night";
            _dayNightIcons = Icons.Material.Filled.DarkMode;
        }

        DarkMode = _isDarkMode;
            _isDarkMode = !_isDarkMode;
            
        string[] uri =  _navigationManager.Uri.Split('/');
        string CurrentPage = uri[uri.Length-1];
        _navigationManager.NavigateTo("/DashboardPublic");
        _navigationManager.NavigateTo("/"+CurrentPage);
         StateHasChanged();


    }

private ThemeManagerTheme _themeManager = new ThemeManagerTheme();
public bool _themeManagerOpen = false;

void OpenThemeManager(bool value)
{
    _themeManagerOpen = value;
}

void UpdateTheme(ThemeManagerTheme value)
{
    _themeManager = value;
    StateHasChanged();
}

protected override void OnInitialized()
{
    StateHasChanged();
}

    
}



